(executable
 (name pack)
 (modules pack))

;; Generate "menhirLib.ml" and "menhirLib.mli" by concatenating all the modules
;; listed in "menhirLib.mlpack". The concatenation is done by the helper script
;; "pack.sh".

(rule
 (targets menhirLib.ml menhirLib.mli)
 (deps (glob_files ../*.{ml,mli}) menhirLib.mlpack)
 (action (run ./pack.exe)))

;; Declare the "menhirLib" library. We explicitly mention the single module
;; generated by the previous rule as otherwise dune would include all modules in
;; the current directory as part of the library.

;; Its [ocamlfind] name is "menhir.lib": Dune requires that all library names be
;; prefixed the the package name, "menhir". To maintain backward compatibility,
;; the next stanza defines a "proxy" package "menhirLib" with a single
;; dependency on "menhir.lib".

(library
 (name menhirLib)
 (public_name menhir.lib)
 (synopsis "Runtime support for code generated by Menhir")
 (modules menhirLib))

(deprecated_library_name
 (old_public_name menhirLib)
 (new_public_name menhir.lib))
